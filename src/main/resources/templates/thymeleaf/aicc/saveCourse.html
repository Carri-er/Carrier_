<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/home">
<div th:replace="~{head/head::head}"></div>

<body>
	<div th:replace="~{nav/nav::nav}"></div>
	<div class="container">
	<h4 class="text-center my-5">코스 저장하기</h4>
		<div class="row mx-0 justify-content-center">
			<div class="row">
			<div class="col">
				<div class="map_mapSection w-100 my-3 ">
				<!-- 지도를 표시할 div 입니다 -->
				<div id="map" style="height: 300px"
						class=" mx-auto rounded-4 w-100"></div>
			</div>
			</div>
			</div>
			<div class="row mx-auto mx-0 px-0 bg-mainbg p-2 my-5">
				<div class="col-12 px-0 mx-0">
					<div class="row courseListRow px-0 mx-0 bg-white p-3 ">
						<div class="col-12 col-md-2 mx-auto text-truncate px-0 mx-0 text-center">
							<a th:href="@{'Event_view?id='+ ${aicc.get(0).getEvent_num()}}" >
								<img
								th:src="@{'../img/info/' + ${aicc.get(0).getEvent_thumbnail()}}"
								alt="" class="img-fluid mx-auto rounded-4 d-block my-3"
								style="width: 100px; height: 100px;">
								<span class="text-center mt-3" th:text="${aicc.get(0).getEvent_name()}"></span>
							</a>
						</div>
						<div class="col-6 col-md-2  mx-auto  text-truncate px-0 mx-0 text-center">
							<a
								th:href="@{'Event_view?id='+ ${aiccFood.get(0).getEvent_num()}}" class="">
								<img
								th:src="@{'../img/info/' + ${aiccFood.get(0).getEvent_thumbnail()}}"
								alt="" class="img-fluid mx-auto rounded-4 d-block my-3"
								style="width: 100px; height: 100px;">
								<span th:text="${aiccFood.get(0).getEvent_name()}"
									class=" mt-3"></span>
							</a>
						</div>
						<div class="col-6 col-md-2  mx-auto  text-truncate px-0 mx-0 text-center">
							<a th:href="@{'Event_view?id='+ ${aicc2.get(0).getEvent_num()}}">
								<img
								th:src="@{'../img/info/' + ${aicc2.get(0).getEvent_thumbnail()}}"
								alt="" class="img-fluid mx-auto rounded-4 d-block my-3"
								style="width: 100px; height: 100px;">
								<span th:text="${aicc2.get(0).getEvent_name()}"
									class="text-center mt-3 "></span>
							</a>
						</div>
						<div class="col-6 col-md-2 mx-auto  text-truncate px-0 mx-0 text-center">
							<a
								th:href="@{'Event_view?id='+ ${aiccFood2.get(0).getEvent_num()}}">
								<img
								th:src="@{'../img/info/' + ${aiccFood2.get(0).getEvent_thumbnail()}}"
								alt="" class="img-fluid mx-auto rounded-4 d-block my-3"
								style="width: 100px; height: 100px;">
								<span th:text="${aiccFood2.get(0).getEvent_name()}"
									class="text-center mt-3 "></span>
							</a>
						</div>
						<div class="col-6 col-md-2 mx-auto  text-truncate px-0 mx-0 text-center">
							<a
								th:href="@{'Event_view?id='+ ${aiccCafe.get(0).getEvent_num()}}">
								<img
								th:src="@{'../img/info/' + ${aiccCafe.get(0).getEvent_thumbnail()}}"
								alt="" class="img-fluid mx-auto rounded-4 d-block my-3"
								style="width: 100px; height: 100px;">
								<span th:text="${aiccCafe.get(0).getEvent_name()}"
									class="text-center"></span>
							</a>
						</div>
					</div>
				</div>



			</div>
			<form action="cours_Save_insert" method="post" id="myForm">
			<div class="row">
			<div class="col-4">
				<div class="col-12 mx-auto mt-4">
					<div class="form-floating">
						<input type="text" class="form-control" id="Course_name"
							name="Course_name" placeholder="코스 명"> <label
							for="Course_name" class="form-label">코스 명</label>
					</div>
				</div>
				<div class="col-12 mx-auto mt-4">
					<div class="form-floating">
						<input type="text" class="form-control" id="Course_thema"
							name="Course_thema" placeholder="코스 테마" th:value="${aicc.get(0).getEvent_category()}"> <label
							for="Course_thema" class="form-label">코스 테마</label>
					</div>
				</div>
				<div class="col-12 mx-auto mt-4">
					<div class="form-floating">
						<input type="text" class="form-control" id="Course_Area"
							name="Course_Area" placeholder="코스 지역" th:value="${aicc.get(0).getEvent_area()}"> <label
							for="Course_Area" class="form-label">코스 지역</label>
					</div>
				</div>
				
				<div class="col-12 mx-auto mt-4">
					<div class="form-floating">
						<input type="text" class="form-control" id="Course_distance"
							name="Course_distance" placeholder="코스 길이" readonly="readonly" th:value="|${totalDistance} km|">
						<label for="Course_distance" class="form-label">코스 길이</label>
					</div>
				</div>
				</div>
				<div class="col-8 mx-auto mt-4">
					<div class="form-floating">
						<textarea class="form-control" placeholder="Leave a comment here"
							id="Course_content" style="height: 300px" name="Course_content"></textarea>
						<label for="Course_content">코스 내용</label>
					</div>

				</div>

				<input type="hidden" th:value="${aicc.get(0).getEvent_num()}" name="cours1"/>
					<input type="hidden" th:value="${aiccFood.get(0).getEvent_num()}" name="cours2"/>
					<input type="hidden" th:value="${aicc2.get(0).getEvent_num()}" name="cours3"/>
					<input type="hidden" th:value="${aiccCafe.get(0).getEvent_num()}" name="cours4"/>
					<input type="hidden" th:value="${aiccFood2.get(0).getEvent_num()}" name="cours5"/>
					<input type="hidden" class="totalDistanceValue" value="" name="cours6"/>
					<input type="hidden" name="memberId" th:value="${session.Member_Id}" />
					<input type="hidden" name="day" th:value="${day}" />
					<input type="hidden" name="img" th:value="${aicc.get(0).getEvent_thumbnail()}" />
					<div class="col-12 mx-auto mt-4 text-end">
						<button type="submit" class="btn btn-main "> 코스 등록</button>
					</div>
					</div>
			</form>

		</div>
	</div>
	<div th:replace="~{footer/footer::footer}"></div>
	<script th:inline="javascript">
      var loginId = /*[[${session.Member_Id}]]*/ "";
      if (loginId == null || loginId.trim() == '') {
         window.location.href = "/login?msg=5";
      }
   </script>
<script th:inline="javascript">
   var mapContainer = document.getElementById('map'); // 지도를 표시할 div 
       var aiccmapx = /*[[${aicc.get(0).getEvent_mapX()}]]*/0; // 이벤트의 위도 값
      var aiccmapy = /*[[${aicc.get(0).getEvent_mapY()}]]*/0; // 이벤트의 경도 값
       var aicc2mapx = /*[[${aicc2.get(0).getEvent_mapX()}]]*/0; // 이벤트의 위도 값
      var aicc2mapy = /*[[${aicc2.get(0).getEvent_mapY()}]]*/0; // 이벤트의 경도 값
       var aiccCafemapx = /*[[${aiccCafe.get(0).getEvent_mapX()}]]*/0; // 이벤트의 위도 값
      var aiccCafemapy = /*[[${aiccCafe.get(0).getEvent_mapY()}]]*/0; // 이벤트의 경도 값
       var aiccFoodmapx = /*[[${aiccFood.get(0).getEvent_mapX()}]]*/0; // 이벤트의 위도 값
      var aiccFoodmapy = /*[[${aiccFood.get(0).getEvent_mapY()}]]*/0; // 이벤트의 경도 값
       var aiccFood2mapx = /*[[${aiccFood2.get(0).getEvent_mapX()}]]*/0; // 이벤트의 위도 값
      var aiccFood2mapy = /*[[${aiccFood2.get(0).getEvent_mapY()}]]*/0; // 이벤트의 경도 값
       
      var aiccname = /*[[${aicc.get(0).getEvent_name()}]]*/""; // 이벤트의 네임 값
      var aicc2name = /*[[${aicc2.get(0).getEvent_name()}]]*/""; // 이벤트의 네임 값
      var aiccCafename = /*[[${aiccCafe.get(0).getEvent_name()}]]*/""; // 이벤트의 네임 값
      var aiccFoodname = /*[[${aiccFood.get(0).getEvent_name()}]]*/""; // 이벤트의 네임 값
      var aiccFood2name =  /*[[${aiccFood2.get(0).getEvent_name()}]]*/""; // 이벤트의 네임 값
     
      var aiccnum = /*[[${aicc.get(0).getEvent_num()}]]*/""; // 이벤트의 넘버 값
      var aicc2num = /*[[${aicc2.get(0).getEvent_num()}]]*/""; // 이벤트의 넘버 값
      var aiccCafenum = /*[[${aiccCafe.get(0).getEvent_num()}]]*/""; // 이벤트의 넘버 값
      var aiccFoodnum = /*[[${aiccFood.get(0).getEvent_num()}]]*/""; // 이벤트의 넘버 값
      var aiccFood2num =  /*[[${aiccFood2.get(0).getEvent_num()}]]*/""; // 이벤트의 넘버 값
      // 문자열로 가져온 값을 parseFloat 함수를 사용하여 숫자로 변환
      mapx = parseFloat(aicc2mapx);
      mapy = parseFloat(aicc2mapy);
            mapOption = { 
                center: new kakao.maps.LatLng(mapx, mapy), // 지도의 중심좌표
                level: 6 // 지도의 확대 레벨
            };
        
            var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
         // 마커를 표시할 위치와 title 객체 배열입니다 
         var positions = [
             {
                 title: aiccname, 
                 number: aiccnum,
                 latlng: new kakao.maps.LatLng(aiccmapx, aiccmapy)
             },
             {
                 title: aiccFoodname, 
                 number: aiccFoodnum,
                 latlng: new kakao.maps.LatLng(aiccFoodmapx, aiccFoodmapy)
             },
             {
                 title: aicc2name, 
                 number: aicc2num,
                 latlng: new kakao.maps.LatLng(aicc2mapx, aicc2mapy)
             },
             {
                 title: aiccCafename,
                 number: aiccCafenum,
                 latlng: new kakao.maps.LatLng(aiccCafemapx, aiccCafemapy)
             },
             {
                 title: aiccFood2name,
                 number: aiccFood2num,
                 latlng: new kakao.maps.LatLng(aiccFood2mapx, aiccFood2mapy)
             }
         ];
         
       


         // 마커 이미지의 이미지 주소입니다
         var imageSrc = ["https://cdn-icons-png.flaticon.com/128/11020/11020536.png",//관광지1,
        	 "https://cdn-icons-png.flaticon.com/128/11020/11020470.png",//음식점
        	 "https://cdn-icons-png.flaticon.com/128/11020/11020536.png",//관광지2
        	 "https://cdn-icons-png.flaticon.com/128/11020/11020485.png",//카페
        	 "https://cdn-icons-png.flaticon.com/128/11020/11020470.png"//음식점2
         ];//관광지2
         for (var i = 0; i < positions.length; i ++) {
         var content = '<div class="bg-pink px-3 p-1 rounded-pill border border-dark text-black" style="position: relative;left:0px;bottom: 65px;font-size: 12px; margin:0 auto;z-index:3;">' + 
         '    <div class="info">' + 
         '            <a href="Event_view?id='+ positions[i].number +'">'+
         '        <div class="title">' + [i+1 ]+". "+
         positions[i].title + 
         '        </div>' + 
         '</a>' +
         '    </div>' +    
         '</div>';
             
             // 마커 이미지의 이미지 크기 입니다
             var imageSize = new kakao.maps.Size(50, 50); 
             
             // 마커 이미지를 생성합니다    
             var markerImage = new kakao.maps.MarkerImage(imageSrc[i], imageSize); 
             
             // 마커를 생성합니다
             var marker = new kakao.maps.Marker({
                 map: map, // 마커를 표시할 지도
                 position: positions[i].latlng, // 마커를 표시할 위치
                 title : positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
                 image : markerImage // 마커 이미지 
             });
             var overlay = new kakao.maps.CustomOverlay({
            	 content: content,
            	 map: map,
            	 position: positions[i].latlng      
            	});
          
         }
       
         var linePath;
         var lineLine = new daum.maps.Polyline();
      
         var distance;
      
         var totalDistance = 0; // 총 거리를 저장할 변수를 초기화합니다.
       
         var subtotalDistance =0;
         for (var i = 0; i < positions.length; i++) {
             if (i != 0) {
                 linePath = [ positions[i - 1].latlng, positions[i].latlng ] //라인을 그리려면 두 점이 있어야하니깐 두 점을 지정했습니다
             }
             ;
             lineLine.setPath(linePath); // 선을 그릴 라인을 세팅합니다
      
             var drawLine = new daum.maps.Polyline({
                 map : map, // 선을 표시할 지도입니다 
                 path : linePath,
                 strokeWeight : 3, // 선의 두께입니다 
                 strokeColor : '#Ef564b', // 선의 색깔입니다
                 strokeOpacity : 0.8, // 선의 불투명도입니다 0에서 1 사이값이며 0에 가까울수록 투명합니다
                 strokeStyle : 'longdash' // 선의 스타일입니다
             });
       
      
             distance = Math.round(lineLine.getLength());
             displayCircleDot(positions[i].latlng, distance);
             totalDistance += distance;
            
           	
              
         }

         
         function displayCircleDot(position, distance) {
             if (distance > 0) {
                 // 클릭한 지점까지의 그려진 선의 총 거리를 표시할 커스텀 오버레이를 생성합니다
                 var distanceOverlay = new daum.maps.CustomOverlay(
                         {
                             //  content : '<div class="dotOverlay bg-white rounded-4 px-3 mt-5">거리 <span class="number">'
                              //       + distance + '</span>m</div>', 
                             position : position,
                             yAnchor : 1,
                             zIndex : 2
                         });
      
                 // 지도에 표시합니다
                 distanceOverlay.setMap(map);
             }
             
         }
      

         
    </script>
    <script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('myForm').addEventListener('submit', function(event) {
            var courseName = document.getElementById('Course_name').value.trim();
            var courseThema = document.getElementById('Course_thema').value.trim();
            var courseArea = document.getElementById('Course_Area').value.trim();
            var courseContent = document.getElementById('Course_content').value.trim();

            var errors = [];

            if (courseName === '') {
                errors.push('코스 명을 입력하세요.');
            }

            if (courseThema === '') {
                errors.push('코스 테마를 입력하세요.');
            }

            if (courseArea === '') {
                errors.push('코스 지역을 입력하세요.');
            }

            if (courseContent === '') {
                errors.push('코스 내용을 입력하세요.');
            }

            if (errors.length > 0) {
                event.preventDefault(); // 폼 제출 중지
                alert(errors.join('\n')); // 에러 메시지 표시
            }
        });
    });
</script>
</body>
</html>