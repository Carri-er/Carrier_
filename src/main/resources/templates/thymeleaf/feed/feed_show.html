<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<div th:replace="~{head/head::head}"></div>
<body>
	<div th:replace="~{nav/nav::nav}"></div>
	<!-- í† ìŠ¤íŠ¸ -->
	<div th:replace="~{alert/toast::div}"></div>
	<!-- ì‚­ì œ ëª¨ë‹¬ -->
	<div th:replace="~{alert/del_modal::div}"></div>
	<div id="feedShow" class="container-fluid mt-4 mb-5 p-0">
	<!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
	<a href="/feed" class="sticky-top feed-btn me-auto ms-4 rounded-circle d-flex">
		<i class="fi fi-sr-angle-small-left f22 text-center m-auto"></i>
	</a>
	<!--------------------------------------------feed box Parent------------------------------------------>
	<div class="row m-auto my-2 mt-lg-1 mb-5 pt-md-0">
		<div class="col-10 col-xl-7 mt-3 feed-box m-0 mx-auto">
			<div class="row">
				<!-- ì¢Œì¸¡ | í”¼ë“œ -->
				<div class="col-12 col-md-6 feed-write-left feed-box p-0 feed-box-width overflow-hidden">
						<!--feed box Start-->
						<div class="col-12 m-0 mb-3 px-0 no-gutters m-auto">
							<!--feed box top-->
							<div class="col-12 hstack feed-box-top p-3 ps-3 z-3">
								<img th:src="@{'../img/member_thumbnail/'+ ${feedList.getMember_profileimage()}}" class="float-start rounded-circle border me-3" width="50" height="50" alt="">
								<!--feed box text-->
								<div class="col flex-grow-1 px-0">
									<span class="float-start fw-bold f15" th:text="${feedList.getMember_Id()}">ì‚¬ìš©ìëª…</span><br>
									<span class="float-start text-muted f13 me-2" th:if="${#strings.contains(feedList.getFeed_updateday,'ì „')}">í•˜ì´ë¼ì´íŠ¸</span>
									<span class="float-start text-muted f13" th:text="${feedList.getFeed_updateday()}">ì˜¬ë¦° ë‚ ì§œ</span>
								</div>
								<!-- ìš°ì¸¡ ë²„íŠ¼ -->
								<div class="col-3 flex-grow-0 d-flex justify-content-end align-items-center">
									<!-- session Idì™€ ê¸€ì“´ì´ê°€ ì¼ì¹˜í•  ë•ŒëŠ” ìˆ˜ì •ë²„íŠ¼ í™œì„±í™” -->
									<a th:if="${session.Member_Id == feedList.getMember_Id()}" th:href="@{'/feed_update?num='+${feedList.getFeed_num()}}" class="btn btn-sm btn-dark me-2">ìˆ˜ì •</a>
										<!-- ë‹¤ë¥¸ ì‚¬ëŒì´ ë³¼ ë•ŒëŠ” ê³µìœ  -->
									<!-- <a th:unless="${session.Member_Id == feedList.getMember_Id()}" href="#" class="p-2"><i class="fi fi-br-paper-plane d-flex align-items-center"></i></a> -->
										<!-- ìˆ˜ì • ë° ì‚­ì œ ë²„íŠ¼  -->
										<div th:if="${session.Member_Id==feedList.Member_Id or session.Member_Id=='admin'}">
											<div class="f17 hstack" id="feed-right">
												<a
													class="dropdown-toggle text-center m-0 ps-2 pt-1 d-block d-flex justify-content-end"
													href="#" role="button" id="dropdownMenuLink"
													data-bs-toggle="dropdown" aria-expanded="false"><i
													class="fi fi-rr-menu-dots-vertical"></i>
												</a>
												<ul class="dropdown-menu dropdown-menu-dark">
													<li data-bs-toggle="modal" data-bs-target="#feed_del_Modal">
														<a class="dropdown-item">ì‚­ì œ</a>
													</li>
												</ul>

												<form action="/delFeed" id="deleteFeedForm">
													<input type="hidden" name="num" th:value="${feedList.getFeed_num()}"/>
												</form>
											</div>
										</div>
								</div>
							</div>
							<!-- feed box center | Carousel image -->
							<div class="col-12 overflow-hidden">
								<div th:id="'feedCarousel'+${feedList.getFeed_num()}" class="carousel slide" data-bs-ride="false">
									<div th:if="${#lists.size(#strings.arraySplit(feedList.getFeed_thumbnail(), ','))>
										 1}" class="carousel-indicators"> <button th:each="thumbnail, thumbnailStat : ${#strings.arraySplit(feedList.getFeed_thumbnail(), ',')}" type="button" th:attr="data-bs-target='#feedCarousel'+${feedList.getFeed_num()}, data-bs-slide-to=${thumbnailStat.index}, class=${thumbnailStat.index==0} ? 'active' : ''" aria-current="true"></button>
									</div>
									<!-- carousel items loop -->
									<div class="carousel-inner col-12 feed-box-center">
										<div th:each="thumbnail, thumbnailStat : ${#strings.arraySplit(feedList.getFeed_thumbnail(), ',')}" class="carousel-item p-0 h-100" th:classappend="${thumbnailStat.index==0} ? 'active' : ''">
											<img th:src="@{'../img/feed_thumbnail/' + ${thumbnail}}" class="d-block img-fluid m-auto w-100" alt="#">
										</div>
									</div>
									<!-- Carousel Prev/Next button -->
									<div th:if="${#lists.size(#strings.arraySplit(feedList.getFeed_thumbnail(), ','))>
										 1}"> <button class="carousel-control-prev" type="button" th:attr="data-bs-target='#feedCarousel'+${feedList.getFeed_num()}" data-bs-slide="prev">
										<span class="carousel-control-prev-icon" aria-hidden="true"></span>
										<span class="visually-hidden">Previous</span>
										</button>
										<button class="carousel-control-next" type="button" th:attr="data-bs-target='#feedCarousel'+${feedList.getFeed_num()}" data-bs-slide="next">
										<span class="carousel-control-next-icon" aria-hidden="true"></span>
										<span class="visually-hidden">Next</span>
										</button>
									</div>
								</div>
							</div>
							<!--feed-box-center | text-->
							<div class="col-12 feed-box-bot p-4 pt-3">
								<span class="fw-bold d-block f17" th:text="${feedList.getFeed_title()}">ë§¥ì£¼ ë§›ì§‘ğŸºâœ¨</span>
								<span class="f14" th:utext="${feedList.getFeed_content()}">ë§¥ì£¼ëŠ” ì™œ ë¨¹ì–´ë„ ë¨¹ì–´ë„ ë§›ìˆì„ê¹Œìš”? </span>
							</div>
							<!--feed box bot | #TAG -->
							<div class="col feed-tag-box p-4 text-muted f13 d-flex gap-1">
								<span class="btn btn-main btn-sm rounded-pill" th:text="${feedList.getFeed_area()}">ì§€ì—­íƒœê·¸</span>
								<span class="btn btn-skyb btn-sm rounded-pill" th:text="${feedList.getFeed_theme()}">í…Œë§ˆíƒœê·¸</span>
							</div>
						</div>
						<!--feed box bot | text-->
	                    <div class="col-12 feed-box-bot hstack p-3 border-top f13 d-flex hstack">
	                        <div class="col-6 hstack justify-content-center border-end d-flex hstack">
	                            <span>ëŒ“ê¸€</span>
                                <i class="fi fi-br-comment-dots hstack px-1"></i>
	                        </div>
	                        <div class="col-6 hstack justify-content-center">
							<div th:if="${feedList.getFeed_heart_on() == 0 or session.Member_Id == null}">
								<a
									th:href="@{'/feed_show_like?num='+${feedList.getFeed_num()}+'&id='+${session.Member_Id}+'&on=1'}"
									class="d-flex"> 
									<span>ì¢‹ì•„ìš”</span>
									<i
									class="fi fi-br-heart hstack px-1"></i>
								</a>
							</div>
							<div th:if="${feedList.getFeed_heart_on()} == 1">
								<a th:href="@{'/feed_show_like?num='+${feedList.getFeed_num()}+'&id='+${session.Member_Id}+'&on=0'}"
									class="d-flex"> 
									<span>ì¢‹ì•„ìš”</span><i
									class="fi fi-sr-heart hstack px-1"></i>
								</a>
							</div>
							<span class="ms-2" th:text="${feedList.getFeed_heart()}" th:if="${session.Member_Id != null}">999+</span>
	                    </div>
	                    </div>
						<!-- tag row -->
						<!-- col -->
					</div>
					<!-- ìš°ì¸¡ | ëŒ“ê¸€ ë‹¤ëŠ” ê³³ -->
					<div class="col p-4">
 					<form th:action="@{'/feed_comment_upload'}" th:object="${Feed_commentDTO}" method="post">
						<p>ëŒ“ê¸€ <b th:text="${Feed_commentList.size()}">ê°œìˆ˜</b> </p>
						<div class="d-flex align-items-center gap-2" th:if="${session.Member_Id}!=null">
							<div class="col flex-grow-0 p-0">
								<input type="hidden" name="Feed_num" th:value="${feedList.getFeed_num()}"/>
								<input type="hidden" name="Member_Id" th:value="${session.Member_Id}"/>
								<img th:src="@{'../img/member_thumbnail/'+ ${session.Member_profileimage}}" class="float-start rounded-circle border" width="45" height="45" alt="">
							</div>
							<div class="col flex-grow-1 p-0">
								<input type="text" th:field="*{Feed_comment}" class="form-control"/>
							</div>
							<div class="col-2 flex-shrink-0 d-sm-flex justify-content-end align-items-center p-0 h-100">
								<button type="submit" class="btn btn-sm btn-dark w-100 h-100 py-2">ë“±ë¡</button>
							</div>
						</div>
					</form>
					<hr/>
					<!-- ë‹¤ë¥¸ ìœ ì € ëŒ“ê¸€ì°½ -->
					<div class="row gap-3 px-2">
						<div class="d-flex align-items-start gap-2" th:each="comment : ${Feed_commentList}">
							<div class="col flex-grow-0 p-0 mt-1">
								<img th:src="@{'../img/member_thumbnail/'+ ${comment.getMember_profileimage()}}" class="float-start rounded-circle border" width="36" height="36" alt="">
							</div>
							<div class="col flex-grow-1 p-0 f14">
								<strong><span class="" th:text="${comment.getMember_Id()}">ì¥ì°½ì—½</span></strong>
								<span class="ms-1 text-muted text-truncate f12" th:text="${comment.getFeed_comment_updateday()}">ëŒ“ê¸€ ë‹¨ ì‹œê°„</span>
								<span class="f14 d-block" th:text="${comment.getFeed_comment()}">ì˜¤ëŠ˜ ì«Œ í˜ë“œë„¤ì—¬</span>
							</div>
							<div class="col-2 flex-shrink-0 d-sm-flex justify-content-end align-items-center p-0 h-100 text-end">
								<th:block th:if="${comment.getFeed_comment_like()}==0">
									<a class="dropdown-item" th:href="@{'/feed_comment_like?num='+${feedList.getFeed_num()}+'&comment_num='+${comment.getFeed_comment_num()}+'&on=1'}">
										<i class="fi fi-br-heart px-2"></i>
									</a>
								</th:block>
								<th:block th:if="${comment.getFeed_comment_like()}==1">
									<a class="dropdown-item" th:href="@{'/feed_comment_like?num='+${feedList.getFeed_num()}+'&comment_num='+${comment.getFeed_comment_num()}+'&on=0'}">
										<i class="fi fi-sr-heart px-2"></i>
									</a>
								</th:block>
								<input type="submit" id="feed-heart" class="h-100 py-2 d-none"/>
								</label>
								<!-- [ë‚´ í”¼ë“œë§Œ] ìˆ˜ì • ë° ì‚­ì œ ë²„íŠ¼  -->
	                            <div th:if="${session.Member_Id == comment.getMember_Id()}">
		                            <div class="f17 d-flex justify-content-between" id="feed-right">
											<a class="dropdown-toggle text-center m-0 hstack" href="#"
												role="button" id="dropdownMenuLink" data-bs-toggle="dropdown"
												aria-expanded="false">
					                            <i class="fi fi-rr-menu-dots hstack mb-1 ms-1">
			                           			</i>
											</a>
										<ul class="dropdown-menu dropdown-menu-dark">
		                                    <li data-bs-toggle="modal" data-bs-target="#feed_del_Modal"><a class="dropdown-item">ì‚­ì œ</a></li>
		                                    <li><a class="dropdown-item" th:href="@{'/feed_comment_update?num='+${feedList.getFeed_num()}+'&comment_num='+${comment.getFeed_comment_num()}}">ìˆ˜ì •</a></li>
		                                </ul>
		                            </div>
		                            
									<!-- DEL Modal -->
									<div class="modal fade" id="feed_del_Modal" tabindex="-1" aria-labelledby="feed_del_ModalLabel" aria-hidden="true">
									  <div class="modal-dialog modal-dialog-centered">
									    <div class="modal-content">
									      <div class="modal-header border-none">
									        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
									      </div>
									      <div class="modal-body text-center py-3">
									        ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
									      </div>
									      <div class="modal-footer border-none">
									        <button type="button" class="btn btn-light text-dark rounded-pill px-3" data-bs-dismiss="modal">ì·¨ì†Œ</button>
									        
									        <form action="/feed_comment_del" id="deleteFeedCommentForm">
												<input type="hidden" name="num" th:value="${feedList.getFeed_num()}"/>
												<input type="hidden" name="comment_num" th:value="${comment.getFeed_comment_num()}"/>
											</form>
									        <button type="button" class="btn btn-main rounded-pill px-3" id="comment_del_btn">
									        	<a class="dropdown-item active" th:href="@{'/feed_comment_del?num='+${feedList.getFeed_num()}+'&comment_num='+${comment.getFeed_comment_num()}}">ì‚­ì œ</a>
									        </button>
									      </div>
									    </div>
									  </div>
									</div>
	                            </div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- row -->
		</div>
		<!---------------------------------------------------------------------------->
	</div>
</div>
<div th:replace="~{footer/footer::footer}">
</div>

	<!-- ì•Œë¦¼ì°½ -->
	<script type="text/javascript">
		$(document).ready(function() {
			// URLì—ì„œ msg ë§¤ê°œë³€ìˆ˜ ê°€ì ¸ì˜¤ê¸°
			const urlParams = new URLSearchParams(window.location.search);
			const msg = urlParams.get('msg');

			// ë©”ì‹œì§€ê°€ ì¡´ì¬í•  ê²½ìš° toastë¡œ í‘œì‹œ
			if (msg !== null && msg !== "") {
				let message;
				if (msg == 1) {
					message = "ê³µë°±ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ëŒ“ê¸€ì€ ì‘ì„±í•˜ì‹¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤";
				}
				if (msg == 2) {
					message = "65ì ì´ë‚´ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”";
				}

				// ë¶€íŠ¸ìŠ¤íŠ¸ë© toast íŠ¸ë¦¬ê±°
				$('.my-toast-body').text(message);
				$('.my-toast').toast('show');
			}
		});
	</script>

	<!-- DELëª¨ë‹¬ -->
	<script>
		function func_delModalBtn() {
			document.getElementById('deleteFeedForm').submit();
		}
		/* function func_delModalBtn_comment() {
			document.getElementById('deleteFeedCommentForm').submit();
		} */

		// #btn-pay ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œì˜ ë™ì‘
		$("#comment_del_btn").click(function() {
			$('#feed_del_Modal').modal('show');

			$.ajax({
				type : "POST",
				url : "feed_comment_del",
				data : formData,
				success : function(response) {
					// ë°ì´í„° ì €ì¥ì— ì„±ê³µí•œ ê²½ìš°
					console.log("ë°ì´í„° ì €ì¥ ì„±ê³µ!");
					console.log(response.courseNum);
				},
				error : function(xhr, status, error) {
					// ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í•œ ê²½ìš°
					console.error("ë°ì´í„° ì €ì¥ ì‹¤íŒ¨!");
					console.error("ì—ëŸ¬: ", error);
				}
			});
		});
	</script>
</body>
</html>