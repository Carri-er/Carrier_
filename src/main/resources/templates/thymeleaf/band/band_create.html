<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<div th:replace="~{head/head::head}"></div>
<div th:replace="~{nav/nav::nav}"></div>
    <div class="container-fluid band_create_wrapper">
        <div class="container py-5 band_create_Box">
        
            <form action="band_create" method="post" enctype="multipart/form-data" id="form_bandCreate">
                <div class="row my-5">
                    <div class="col-md-8 col-lg-7 col-xl-7 mx-auto my-5">
                    	<input name="band_admin" type="hidden" th:value="${session.Member_Id}"/>
                        <p class="h4 text-center">밴드 대표사진을 설정해주세요.</p>
                        <input name="band_thumnail" class="form-control" type="file" id="formFileMultiple"  onchange="readURL(this);" multiple >
                        
						<img id="blah" src="http://placehold.it/200" alt="#" class="border my-3 mx-auto d-block " width="200" height="200"/>
						
						<div class="form-floating mb-3">
							<input name="band_name" type="text" class="form-control" id="input_bandName" placeholder="밴드 이름 입력" size="15">
  							<label for="input_bandName">밴드 이름을 입력해주세요.</label>
						</div>
                        

						<div class="form-floating">
							<textarea name="band_content" class="form-control" placeholder=""
								id="textarea_bandContent" style="height: 200px"></textarea>
							<label for="textarea_bandContent">밴드 소개글을 입력해주세요.</label>
						</div>
                        
                        <input type="button" value="밴드 생성" onclick="return func_createBand()" class="btn btn-main w-100 p-3 rounded-pill mt-5"/>
                    </div>
                </div>
            </form>
            
        </div> <!-- band_create_Box -->
    </div> <!-- band_create_wrapper -->
    
<div th:replace="~{footer/footer::footer}"></div>
    
    <script th:inline="javascript">
    var bandList = /*[[${bandList}]]*/ [];
    
    console.log(bandList);
    	
    /* 밴드 대표 이미지 선택 시 출력하는 함수 */
	    function readURL(input) {
	        if (input.files && input.files[0]) {
	            var reader = new FileReader();
	
	            reader.onload = function (e) {
	                $('#blah')
	                    .attr('src', e.target.result);
	            };
	
	            reader.readAsDataURL(input.files[0]);
	        }
	    }
	    
	    function validateBandName(input) {
	    	var regex = /^[가-힣a-zA-Z][가-힣a-zA-Z0-9\s]{1,19}$/;
	        var specialCharRegex = /[~!@#$%^&*()+\=\[\]{};':"\\|,.<>\/?]/;
	        var vowelRegex = /[aeiouㄱ-ㅎㅏ-ㅣ]/i; // 모음이 하나라도 있는 경우 거부

	        return !specialCharRegex.test(input) && regex.test(input) && !vowelRegex.test(input);
	    }
    	
	   
	    
    	/* 밴드 생성 유효성 검사 */
	    function func_createBand() {
	 	   
	 	  var input_bandName = $('#input_bandName').val();
	 	  var textarea_bandContent = $('#textarea_bandContent').val();
	 	  
	 	 for(var i = 0 ; i < bandList.length ; i++) {
	 		 if( bandList[i].band_name == input_bandName){
	 			 alert("동일한 밴드가 존재합니다.");
	 			 return false;
	 		 }
	 		
	 	 }
	 	 
	 	   if(input_bandName.length == 0){
	 		   alert('밴드 이름을 입력하세요.');
	 		   
	 		  input_bandName.focus();
	 		 $('#label_bandName').focus();
	 		  return false;
	 		  
	 	   } else if ( !validateBandName(input_bandName) ){
	 		  alert(' 밴드 이름을 다시 입력해주세요. (2~20) ');
	 		  $('#label_bandName').focus();
	 		 return false;
	 		  
	 	   } else if(textarea_bandContent.length == 0){
	 		   
	 		 	alert('밴드 설명을 입력하세요.');
	 		 	
	 		 	textarea_bandContent.focus();
	 		 	$('#label_bandContent').focus();
	 		
	 		 return false; 
	 		 
	 	   } else if (textarea_bandContent.length > 50){
	 		  alert('밴드 설명은 50글자 미만으로 작성해주세요.');
	 		 	
	 		 	textarea_bandContent.focus();
	 		 	$('#label_bandContent').focus();
	 		
	 		 return false; 
	 	   }else { 
	 		  document.getElementById('form_bandCreate').submit();
	 		  
	 	   }
	 	   
	 	   
	 	}
    	
	    
		
	   
    </script>
</body>
</html>